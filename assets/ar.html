
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <link rel="shortcut icon" href="#">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>AR</title>
    <style>
        .text-label {
            width: 55px;
            background-color: yellow; /* 設置背景顏色 */
            border: 1px solid black; /* 設置邊框 */
            padding: 5px; /* 設置內邊距 */
            border-radius: 5px; /* 設置圓角 */
        }
        

    </style>
    <script>
        
        AFRAME.registerComponent('clicker2-1', {
            init: function () {
                var el = this.el;

                // 监听实体元素的点击事件
                el.addEventListener('click', function () {
                    // 获取按钮实体元素的可见性属性
                    var buttonVisible = document.getElementById('showButton2').getAttribute('visible');

                    // 如果按钮可见，则执行点击事件的功能
                    if (buttonVisible) {
                        // 在这里添加点击功能的代码
                        alert('按钮1被点击了！');
                    }
                });
            }
        });

        AFRAME.registerComponent('clicker2-2', {
            init: function () {
                var el = this.el;

                // 监听实体元素的点击事件
                el.addEventListener('click', function () {
                    // 获取按钮实体元素的可见性属性
                    var buttonVisible = document.getElementById('showButton2').getAttribute('visible');

                    // 如果按钮可见，则执行点击事件的功能
                    if (buttonVisible) {
                        // 在这里添加点击功能的代码
                        alert('按钮2被点击了！');
                    }
                });
            }
        });

        AFRAME.registerComponent('clicker2-3', {
            init: function () {
                var el = this.el;

                // 监听实体元素的点击事件
                el.addEventListener('click', function () {
                    // 获取按钮实体元素的可见性属性
                    var buttonVisible = document.getElementById('showButton2').getAttribute('visible');

                    // 如果按钮可见，则执行点击事件的功能
                    if (buttonVisible) {
                        // 在这里添加点击功能的代码
                        alert('按钮3被点击了！');
                    }
                });
            }
        });






        
    </script>
</head>
<body  >

    <div id="arContainer" style="height:100px ;">
        <a-scene id="scene" arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false' renderer='antialias: true; alpha: true' vr-mode-ui="enabled:false" cursor='rayOrigin: mouse'>
            
            <a-camera id="camera" gps-new-camera='gpsMinDistance: 5'></a-camera>
            
            <a-entity id="target1"  material='color: purple' geometry='primitive: box' gps-new-entity-place="latitude: 24.14977351688243; longitude: 120.68377231768088" scale="4 4 4" visible="false"  look-at='[camera]'  >
                <!-- 標題 -->
                <a-entity position="0 1 0" look-at='[camera]'>
                  <a-entity geometry="primitive: plane" material="color: black" scale="1 0.5 0.1" ></a-entity>
                  <a-text value="mis" position="0 0 0.2" align="center"></a-text>
              </a-entity>

              <a-entity id="showButton1" visible="false">
                  <!-- 子平面1 -->
                  <a-entity geometry="primitive: plane" material="color: blue" scale="0.5 0.5 0.5" position="0 -1 0" clicker2-1>
                      <a-text value="button1" align="center"></a-text>    
                  </a-entity>
                  
                  <!-- 子平面2 -->
                  <a-entity geometry="primitive: plane" material="color: red" scale="0.5 0.5 0.5" position="0.5 -1 0" clicker2-2>
                      <a-text value="button2" align="center"></a-text>    
                  </a-entity>
                  
                  <!-- 子平面3 -->
                  <a-entity geometry="primitive: plane" material="color: green" scale="0.5 0.5 0.5" position="-0.5 -1 0" clicker2-3>
                      <a-text value="button3" align="center"></a-text>    
                  </a-entity>
                </a-entity>      
            </a-entity>
            
            <a-entity id="target2"  material='color: red' geometry='primitive: box' gps-new-entity-place="latitude: 24.151025939583285; longitude: 120.68141029301923" scale="4 4 4" visible="false"  look-at='[camera]'>
              
                <a-entity position="0 1 0" look-at='[camera]'>
                  <a-entity geometry="primitive: plane" material="color: black" scale="1 0.5 0.1" ></a-entity>
                  <a-text value="home" position="0 0 0.2" align="center"></a-text>
              </a-entity>

              <a-entity id="showButton2" visible="false">
                  <!-- 子平面1 -->
                  <a-entity geometry="primitive: plane" material="color: blue" scale="0.5 0.5 0.5" position="0 -1 0" clicker2-1>
                      <a-text value="button1" align="center"></a-text>    
                  </a-entity>
                  
                  <!-- 子平面2 -->
                  <a-entity geometry="primitive: plane" material="color: red" scale="0.5 0.5 0.5"  position="0.5 -1 0" clicker2-2>
                      <a-text value="button2" align="center"></a-text>    
                  </a-entity>
                  
                  <!-- 子平面3 -->
                  <a-entity geometry="primitive: plane" material="color: green" scale="0.5 0.5 0.5"  position="-0.5 -1 0" clicker2-3>
                      <a-text value="button3" align="center"></a-text>    
                  </a-entity>
              </a-entity>

            </a-entity>        
        </a-scene>
    </div>

    <script>

      
                

        
            updateUserLocation1();
          // 設置所有目標的位置（經緯度）
            var targets = [
                { id: 'target1', latitude: 24.14977351688243, longitude: 120.68377231768088, botton:'showButton1' },
                { id: 'target2', latitude: 24.151025939583285, longitude: 120.68141029301923, botton:'showButton2' },
                // 添加其他目標的位置...
            ];

            // 更新用戶位置
            function updateUserLocation1() {
                navigator.geolocation.watchPosition(function(position) {
                    var userLat = position.coords.latitude;
                    var userLng = position.coords.longitude;
                    
                    // 遍歷所有目標
                    targets.forEach(function(target) {
                        var distance = calculateDistance(userLat, userLng, target.latitude, target.longitude);
                        console.log(distance)
                        // 如果用戶靠近目標，則顯示該目標，否則隱藏該目標
                        if (distance <= 50  ) { // 將距離從公里轉換為公尺
                            showTarget(target.id);
                        } else {
                            hideTarget(target.id);
                        }
                        if (distance <= 25) {
                            showButton(target.botton);
                        } else {
                            hideButton(target.botton);
                        }
                    });
                });
            }

            // 計算兩個經緯度之間的距離
            function calculateDistance(userLat, userLon, targetLat, targetLon) {
                var R = 6371e3; // meters
                var φ1 = userLat * Math.PI / 180;
                var φ2 = targetLat * Math.PI / 180;
                var Δφ = (targetLat - userLat) * Math.PI / 180;
                var Δλ = (targetLon - userLon) * Math.PI / 180;

                var a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                        Math.cos(φ1) * Math.cos(φ2) *
                        Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

                var d = R * c;
                return d;
            }
                    

            // 顯示目標
            function showTarget(targetId) {
                var targetEntity = document.getElementById(targetId);
                if (targetEntity) {
                    targetEntity.setAttribute('visible', true);
                }
            }

            // 隱藏目標
            function hideTarget(targetId) {
                var targetEntity = document.getElementById(targetId);
                if (targetEntity) {
                    targetEntity.setAttribute('visible', false);
                }
            }

            // 显示新的目标
            function showButton(buttonId) {
                var buttonEntity = document.getElementById(buttonId);
                if (buttonEntity) {
                    buttonEntity.setAttribute('visible', true);
                }
            }
            // 隐藏新的目标
            function hideButton(buttonId) {
                var buttonEntity = document.getElementById(buttonId);
                if (buttonEntity) {
                    buttonEntity.setAttribute('visible', false);
                }
            }
      </script>


    
    
    <div id="map" style="position: fixed; bottom: 0; width: 100%; height: 25%;">

    </div>

    <!-- 引入 Leaflet 库的 CSS 文件 -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- 引入 Leaflet 库的 JavaScript 文件 -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([0, 0], 10);
        var marker; // 声明标记变量
        var bounds = L.latLngBounds([40.712, -74.227], [40.774, -74.125]);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var isFirstLocation = true; // 用于标记是否是第一次获取位置

        function updateUserLocation() {
            navigator.geolocation.watchPosition(function(position) {
                var lat = position.coords.latitude;
                var lng = position.coords.longitude;

                // 设置地图中心位置
                if (isFirstLocation) {
                    map.setView([lat, lng], 15); // 第一次定位时缩放
                    isFirstLocation = false; // 标记为非第一次定位
                } else {
                    map.panTo([lat, lng]); // 更新定位时不缩放
                }

                // 创建或更新用户位置标记
                if (!marker) {
                    // 创建定位的标记并设置红色图标
                    marker = L.marker([lat, lng], {icon: redIcon}).addTo(map);
                } else {
                    marker.setLatLng([lat, lng]);
                }
            }, function(error) {
                console.error('获取用户位置失败:', error);
            });
        }

        var redIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
            });


        // 初始化时更新用户位置
        updateUserLocation();
        
        

        // 标记几个坐标点
        var coordinates = [
            [24.149611, 120.683639],
            [24.150412633308154, 120.68306559887918],
            [24.149932396296602, 120.68247869372605],
            [24.1496005951253, 120.68297628722546],
            [24.150499948941835, 120.68385345525628],
            [24.15125377137894, 120.68286464766204],
            [24.151195561311393, 120.6839938021415],
            [24.151376012433865, 120.68231920860443],
            [24.152229312318074, 120.6834945118264]
        ];

        // 循环添加默认样式的标记
        coordinates.forEach(function(coord) {
            L.marker(coord).addTo(map);
        });
        L.marker([24.15222074318936, 120.68126153317971]).addTo(map).on('click', function() {
            // 創建一個彈出框，顯示 "hello" 文字和一個按鈕
            var popupContent = `
                <div style="text-align:center;">
                    <p>Hello</p>
                    <button id="myButton" style="background-color:blue;color:white;padding:5px 10px;border:none;">顯示所有目標點</button>
                </div>
            `;

            var popup = L.popup()
                .setLatLng([24.1525, 120.68126153317971]) // 設置彈出框的位置，固定在特定的經緯度上
                .setContent(popupContent) // 設置彈出框的內容，包括文字和按鈕
                .openOn(map); // 在地圖上打開彈出框

            var isTarget1Visible = true; // 跟踪第一個目標的可見性

            // 添加事件監聽器到按鈕上
            var button = document.getElementById('myButton');


            button.addEventListener('click', function() {
                
                // 根據目標的可見性切換按鈕文字和顯示狀態
                if (isTarget1Visible) {
                    // 隱藏所有目標
                    document.getElementById('target1').setAttribute('visible', true);
                    document.getElementById('target2').setAttribute('visible', true);

                    
                    // 更新按鈕文字
                    button.innerText = '隱藏所有目標點';

                    
                } else {
                    // 顯示所有目標
                    document.getElementById('target1').setAttribute('visible', false);
                    document.getElementById('target2').setAttribute('visible', false);
                    
                    if (document.getElementById('target3')) {
                        document.getElementById('target3').remove();
                    }
                    // 更新按鈕文字
                    button.innerText = '顯示所有目標點';
                }
                
                // 切換目標可見性狀態
                isTarget1Visible = !isTarget1Visible;

                 
            });
           



        });
        // 在地圖上創建一個圖層，用於顯示文字
        var textLayer = L.layerGroup().addTo(map);

        // 要顯示的文字內容和座標
        var text = "example";
        var latlng = [24.15222074318936, 120.6812];

        // 創建一個文字標記
        var textMarker = L.marker(latlng, {
            icon: L.divIcon({
                html: `<div class='text-label'>${text}</div>` // 在 HTML 中插入文字
            })
        });
        

        // 將文字標記添加到文字圖層上
        textMarker.addTo(textLayer);




    </script>
    
</body>
</html>
